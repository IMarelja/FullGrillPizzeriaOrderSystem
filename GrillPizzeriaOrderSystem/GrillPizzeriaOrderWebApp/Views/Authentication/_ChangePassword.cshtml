@model AuthenticationResult
@using ModelConstants
@{
    Layout = null;
}


<div class="card shadow-sm">
    <div class="card-header d-flex align-items-center">
        <span class="material-icons-outlined me-2">lock</span>
        <h5 class="mb-0">Change Password</h5>
    </div>
    <div class="card-body">
        <form id="changePasswordForm" asp-controller="Authentication" asp-action="_ChangePassword" method="post" novalidate>
            @Html.AntiForgeryToken()

            <div class="mb-3">
                <label for="CurrentPassword" class="form-label">Current Password</label>
                <input id="CurrentPassword" name="CurrentPassword" type="password" class="form-control" required minlength="6" autocomplete="current-password" />
                <div class="invalid-feedback">Please enter your current password.</div>
            </div>

            <div class="mb-3">
                <label for="NewPassword" class="form-label">New Password</label>
                <input id="NewPassword" name="NewPassword" type="password" class="form-control" required minlength="8" autocomplete="new-password" />
                <div class="form-text">Use at least  characters (mix of letters, numbers, symbols recommended).</div>
                <div class="invalid-feedback">Please enter a valid new password (min 8 chars).</div>
            </div>

            <div class="mb-3">
                <label for="ConfirmPassword" class="form-label">Confirm New Password</label>
                <input id="ConfirmPassword" name="ConfirmPassword" type="password" class="form-control" required minlength="8" autocomplete="new-password" />
                <div class="invalid-feedback">Please confirm your new password.</div>
            </div>

            <div class="d-flex gap-2">
                <button type="submit" class="btn btn-warning">
                    <span class="material-icons-outlined align-middle me-1" style="font-size:18px">key</span>
                    Change Password
                </button>
                <button type="reset" class="btn btn-light">
                    <span class="material-icons-outlined align-middle me-1" style="font-size:18px">restart_alt</span>
                    Clear
                </button>
            </div>
            <div>
                <span id="changePwdStatus" class="form-text 
                                                if(@Model?.Success){
                                                    text-success
                                                }else{
                                                    text-danger 
                                                } mt-2">
                      
                     @Model?.Message
                </span>
            </div>
        </form>
    </div>
</div>

<script>
    (function () {
        const form = document.getElementById('changePasswordForm');
        const newPwd = document.getElementById('NewPassword');
        const confirm = document.getElementById('ConfirmPassword');
        const statusEl = document.getElementById('changePwdStatus');

        function matchValidation() {
            if (confirm.value && newPwd.value !== confirm.value) {
                confirm.setCustomValidity('Passwords do not match');
            } else {
                confirm.setCustomValidity('');
            }
        }

        newPwd.addEventListener('input', matchValidation);
        confirm.addEventListener('input', matchValidation);

        form.addEventListener('submit', function (e) {
            matchValidation();
            if (!form.checkValidity()) {
                e.preventDefault();
                e.stopPropagation();
            }
            form.classList.add('was-validated');
        }, false);
    })();
</script>
